<?xml version="1.0" encoding="UTF-8" ?>

<!--
## ********************************************************************* ##
## Copyright 2016                                                        ##
## Jack Green, Nick Chura                                                ##
##                                                                       ##
## This file is part of the Mount Hood Community College                 ##
## Precalculus Project                                                   ##
##                                                                       ##
## ********************************************************************* ##
-->

<chapter xml:id="chapter-composition-and-inverse" xmlns:xi="http://www.w3.org/2001/XInclude">

    <title>Composition of Functions and Inverses of Functions</title>

    <introduction>
        <objectives xml:id="outcomes-composition-and-inverse">
            <title>Student Learning Outcomes</title>
            <ul>
                <li><p>Define composite functions and combinations of functions and apply and interpret these in appropriate situations.</p></li>
                <li><p>Evaluate, apply, and interpret function notation, including the notation for inverse functions and composition of functions.</p></li>
                <li><p>Demonstrate the inverse relationship between an exponential function and a logarithmic function (with the same base).</p></li>
            </ul>
        </objectives>

        <list>
            <title>Video Lectures</title>
            <!-- If we can get these videos up onto YouTube, much easier to embed -->
            <dl>
                <li>
                    <title>Composition of Functions</title>
                    <!--<video source="http://stream.mhcc.edu/videos/greenja/captioned/m07-lec-composition-captioned_-_20150124_193451_26.html" />-->
                </li>
                <li>
                    <title>Inverses of Functions</title>
                    <!--<video source="http://stream.mhcc.edu/videos/greenja/captioned/m07-lec-inverse-functions-captioned_-_20150124_202541_26.html" />-->
                </li>
            </dl>
        </list>

    </introduction>

    <xi:include href="./activity-composition.xml" />
    <xi:include href="./activity-inverse.xml" />

    <conclusion>
      <subsection>
        <title>Summary of Composition</title>
<todo> Fix units </todo>

        <p>The <term>composition</term> of functions is really about using the <em>output</em> of one function as the <em>input</em> for another.</p>
        <p>The notation we will use for composing two functions is <me>f(g(x))</me> which we read as "<m>f</m> of <m>g</m> of <m>x</m>".</p>
        <p>Working from the inside-out, this means that the function <m>g</m> is used first to get an output, and then that output is used as the <em>input</em> for the function <m>f</m>.</p>

        <exercise xml:id="exercise-composition-numbers">
          <statement>
            <p>Suppose <m>f(x) = 3x + 4</m> and <m>g(x) = x^2 + x</m>. Compute each of the following compositions:</p>
            <ol>
              <li><m>f(g(5))</m></li>
              <li><m>g(f(5))</m></li>
            </ol>
          </statement>
          <hint><p>Remember to work inside the parentheses first.</p></hint>
          <answer>
            <p>We must first work inside the parentheses to find the value of <m>g(5)</m>, and then use that value as the input for <m>f</m>.</p><md>
            <mrow>f(g(5)) \amp= f(5^2 + 5)</mrow>
            <mrow>\amp= f(30)</mrow>
            <mrow>\amp= 3\cdot30 + 4</mrow>
            <mrow>\amp= 94</mrow></md>
          </answer>
          <answer>
            <p>We must first work inside the parentheses to find the value of <m>f(5)</m>, and then use that value as the input for <m>g</m>.</p><md>
            <mrow>g(f(5)) \amp= g(3\cdot5 + 4)</mrow>
            <mrow>\amp= g(19)</mrow>
            <mrow>\amp= 19^2 + 19</mrow>
            <mrow>\amp= 380</mrow></md>
          </answer>
        </exercise>

        <p>If we use function composition with a numerical input, we will get a numerical answer. However, if we just use <m>x</m> as the input and compose functions, the result will be an expression involving <m>x</m> &#8212; a brand new function which represents the composition.</p>
        <p>This new function is called a <term>composite</term> function.</p>

        <exercise xml:id="exercise-composition-formulas">
          <statement>
            <p>Again, let <m>f(x) = 3x + 4</m> and <m>g(x) = x^2 + x</m>. This time, perform the compositions by using <m>x</m> as the input.</p>
            <ol>
              <li><m>f(g(x))</m></li>
              <li><m>g(f(x))</m></li>
            </ol>
          </statement>
          <hint><p>Remember to simplify the expression inside the parentheses first.</p></hint>
          <answer>
            <p>We must first substitute the expression for <m>g(x)</m> inside the parentheses, and then use that expression as the input for <m>f</m>.</p><md>
            <mrow>f(g(x)) \amp= f(x^2 + x)</mrow>
            <mrow>\amp= 3(x^2 + x) + 4</mrow>
            <mrow>\amp= 3x^2 + 3x + 4</mrow></md>
          </answer>
          <answer>
            <p>We must first substitute the expression for <m>f(x)</m> inside the parentheses, and then use that expression as the input for <m>g</m>.</p><md>
            <mrow>g(f(x)) \amp= g(3x + 4)</mrow>
            <mrow>\amp= (3x + 4)^2 + (3x + 4)</mrow>
            <mrow>\amp= 9x^2 + 24x + 16 + 3x + 4</mrow>
            <mrow>\amp= 9x^2 + 27x + 20</mrow></md>
          </answer>
        </exercise>

          <p>Notice something important about the formula you found for <m>g(f(x))</m> in example <xref ref="exercise-composition-formulas" />: Leaving <m>x</m> as the input, you found that <m>g(f(x)) = 9x^2 + 27x + 20</m>. Now, if you evaluated this new formula at the input <m>x = 5</m>, you would get: <md>
          <mrow>9(5)^2 + 27(5) + 20 \amp= 9\cdot25 + 27\cdot5 + 20</mrow>
          <mrow>\amp= 225 + 135 + 20</mrow>
          <mrow>\amp= 380</mrow></md></p>
          <p>This is exactly the same result you got when you evaluated <m>g(f(5))</m> in example <xref ref="exercise-composition-numbers" />.</p>
          <p>The formula <m>g(f(x)) = 9x^2 + 27x + 20</m> is really a new, single function that represents the composition <m>f(g(x))</m>. Once you've found this formula, you could quickly evaluate many numerical compositions, such as <m>f(g(7))</m> or <m>f(g(-3.6))</m>, without having to think about <m>g</m> and <m>f</m> separately.</p>

        <p>The next example uses function composition in the context of a patient taking blood pressure medicine.</p>
          <example xml:id="example-composition-blood-pressure">
            <p>Let <m>C</m> represent the concentration, measured in mg/kg, of a blood pressure regulating drug in a patient's bloodstream as a function of time <m>t</m>, measured in hours. As time goes on, the concentration of the drug in the bloodstream decreases as the body metabolizes and/or excretes it.</p>
            <p>At the same time, the drug is meant to help lower the patient's blood pressure <m>P</m>, measured in mm Hg. So, as the drug leaves the patient's bloodstream, the blood pressure increases.</p>
            <p>Therefore, <m>P</m> depends on <m>C</m>, and <m>C</m> depends on <m>t</m>.</p>
            <p>There is a function which represents how <m>C</m> depends on <m>t</m>. We will call this function <m>f</m>, and write <m>C = f(t)</m>.</p>
<todo>Write a few teaser questions here.</todo>

            <p>There is another function which represents how <m>P</m> depends on <m>C</m>. We will call this function <m>g</m>, and write <m>P = g(C)</m>.</p>
            <p>So, we would first use <m>f(t)</m> to find the concentration <m>C</m> of the drug in the bloodstream, and then use that concentration as the input for the function <m>g(C)</m> in order to find the patient's blood pressure <m>P</m>.</p>
            <p>In function notation, this would look like:<md>
              <mrow>P \amp= g(C)</mrow>
              <mrow>\amp=g(f(t))</mrow></md></p>
            <p>That last expression, <m>g(f(t))</m>, is a <term>composite function</term>, and it shows that the blood pressure is really a function of <m>t</m>.</p>

          </example>

          <p>Continue example <xref ref="example-composition-blood-pressure" /> in the next exercise, evaluating the composition with a numerical input.</p>

            <exercise>
              <webwork xml:id="heart-rate-evaluate">
                <setup>
                  <var name="$hours"><static>20</static></var>
                  <var name="$conExpression"><static>f(20)</static></var>
                  <var name="$bpOfConExpression"><static>g(f(20))</static></var>
                  <var name="$conAtHours"><static>5*exp(-0.058*20)</static></var>
                  <var name="$bpAtHours"><static>-12.5*(20-1)+160</static></var>
                  <pg-code>
                    Context('Numeric');
                    $hours = random(15,20,1);
                    $conAtHours=Compute("5*2.718282**(-0.058*$hours)");
                    $bpAtHours=Compute("-12.5*$conAtHours+172.5");
                  </pg-code>
                </setup>

                <statement>
                  <p>The blood pressure drug <em>lisinopril</em> works best when it is consumed at an initial concentration of <m>5</m> mg/kg, and its concentration decreases exponentially, with a half-life of 12 hours.</p>
                  <p>Therefore, the concentration can be modeled by the function <me>C = f(t) = 5e^{-0.058t}</me> where <m>t</m> represents the number of hours after it was consumed.</p>
                  <p>Suppose that a patient with hypertension is admitted with blood pressure at 160 mm Hg. Administering the drug at a concentration of 5 mg/kg reduces their blood pressure to 110 mm Hg. As the drug's concentration decreases over time, their blood pressure increases linearly, returning to 160 mm Hg when the concentration drops to 1 mg/kg.</p>
                  <p>Therefore, the expected blood pressure can be modeled by the function<md>
                    <mrow>P = g(C) = -12.5C + 172.5</mrow></md></p>
                  <ul>
                    <li><p>What is the concentration of the drug after <var name="$hours" /> hours?</p>
                    <p><m>C = f(<var name="$hours" />) = </m><var name="$conAtHours" width="15" /></p></li>
                    <li><p>What is the expected blood pressure after <var name="$hours" /> hours?</p>
                    <p><m>P = g(f(<var name="$hours" />)) = </m><var name="$bpAtHours" width="15" /></p></li>
                  </ul>
                </statement>
                <solution>
                  <ol>
                    <li><p>The concentration after <var name="$hours" /> hours is <var name="$conAtHours" />, and its value is <var name="$conAtHours" /> mg/kg.</p></li>
                    <li><p>The blood pressure after <var name="$hours" /> hours is <var name="$bpAtHours" />, and its value is <var name="$bpAtHours" /> mm Hg.</p></li>
                  </ol>
                </solution>
              </webwork>
            </exercise>

            <p>Finally, we conclude example <xref ref="example-composition-blood-pressure" /> by finding the formula for a <term>composite function</term>.</p>

            <exercise>
              <webwork xml:id="heart-rate-formula">
                <setup>
                  <var name="$answer">
                    <set>
                      <member>\text{?}</member>
                      <member correct="yes">-12.5*(5*exp{-0.058*t})+172.5</member>
                      <member>5*e^{-0.058(-12.5C+172.5)}</member>
                      <member>\left(5*e^{-0.058*t}\right)\left(-12.5C+172.5\right)</member>
                    </set>
                  </var>

                  <pg-code>
                    Context()->variables->are(t=>'Real', C=>'Real');
                    $answer=RadioButtons(
                    ["\(-12.5\left(5e^{-0.058t}\right)+172.5\)","\(5e^{-0.058(-12.5C+172.5)}\)","\(\left(-12.5C+172\right)\left(5e^{-0.058t}\right)\)"], 0, labels => ["option 1","option 2","option 3"],
                    displayLabels => 0
                    );


                  </pg-code>
                </setup>
                <statement>
                  <p>If we wanted to, we could have written the formula for <m>P</m> as a function of <m>t</m> by composing the two functions:<md>
                    <mrow>C \amp= f(t) = 5e^{-0.058t}</mrow>
                    <mrow>P \amp= g(C) = -12.5C + 172.5</mrow></md></p>
                  <p>What is the correct formula for the composite function <m>g(f(t))</m>?</p>
                  <p><var name="$answer" form="buttons" /></p>
                </statement>
                <hint>
                  <p>Try writing the function <m>g(C)</m>, but use the formula for <m>f(t)</m> in the place of <m>C</m>.</p>
                </hint>
                <solution>
                  <p>The correct formula for <m>g(f(t))</m> is: <me>-12.5\left(5e^{-0.058t}\right)+172.5</me></p>
                  <p>Note that the second option <me>5e^{-0.058(-12.5C+172.5)}</me> is actually the composite function <m>f(g(C))</m>, which really makes no sense in context. The output for <m>g(C)</m> is the blood pressure, and that is not the correct input for the function <m>f(t)</m>.</p>
                  <p>The last option <me>\left(-12.5C+172\right)\left(5e^{-0.058t}\right)</me> is actually the product <m>f(t)\cdot g(C)</m>, which again does not make sense in context. This would result in multiplying the outputs of <m>f(t)</m> and <m>g(C)</m>, so the output would be <em>concentration</em> multiplied by <em>blood pressure</em>.</p>
                </solution>
              </webwork>
            </exercise>

          <paragraphs>
            <p>Even outside of a context, knowing how to write a formula for a composite function is an important skill.</p>
            <p>In the next problem, practice writing formulas for <m>f(g(x))</m> and <m>g(f(x))</m>.</p>
          </paragraphs>

            <exercise>
              <webwork xml:id="composition-formula-examples">
                <setup>
                  <var name="$GofF"><static>\left(\frac{x}{x+4}\right)^2</static></var>
                  <var name="$F"><static>\frac{x}{x+4}</static></var>
                  <var name="$G"><static>x^2</static></var>
                  <var name="$FofG"><static>\frac{x^2}{x^2+4}</static></var>
                  <pg-code>
                    $GofF=Compute("(x/(x+4))^2");
                    $F=Compute("x/(x+4)");
                    $G=Compute("x^2");
                    $FofG=Compute("x^2/(x^2+4)");
                  </pg-code>
                </setup>

                <statement>
                  <p>Let <m>f(x) = \frac{x}{x+4}</m> and <m>g(x) = x^2</m>.</p>
                  <ol>
                    <li><p>Write the formula for the composite function <m>g(f(x))</m>.</p>
                    <p>Start by substituting the formula for <m>f(x)</m> into the function <m>g</m>:</p>
                    <p><m>g(f(x)) = g(</m><var name="$F" width="15" /><m>)</m></p>
                    <p>Then simplify the expression you wrote above, by using the formula for <m>g(x)</m>.</p>
                    <p><m>g(f(x)) = </m><var name="$GofF" width="15" /></p></li>
                    <li><p>Write the formula for the composite function <m>f(g(x))</m>.</p>
                    <p>Start by substituting the formula for <m>g(x)</m> into the function <m>f</m>:</p>
                    <p><m>f(g(x)) = f(</m><var name="$G" width="15" /><m>)</m></p>
                    <p>Then simplify the expression you wrote above, by using the formula for <m>f(x)</m>.</p>
                    <p><m>f(g(x)) = </m><var name="$FofG" width="15" /></p></li>
                  </ol>
                </statement>
                <solution>
                  <ol>
                    <li>The formula for <m>g(f(x))</m> is:<md>
                    <mrow>g(f(x)) \amp= g(\frac{x}{x+4})</mrow>
                    <mrow>\amp= \left(\frac{x}{x+4}\right)^2</mrow></md></li>
                    <li>The formula for <m>f(g(x))</m> is:<md>
                    <mrow>f(g(x)) \amp= f(x^2)</mrow>
                    <mrow>\amp= \frac{x^2}{x^2+4}</mrow></md></li>
                  </ol>
                </solution>
              </webwork>
            </exercise>
      </subsection>


      <subsection>
        <title>Summary of Inverses</title>
        <p>Two functions are called <term>inverses</term> if they <em>undo</em> each other. If one function has a certain process, then the other function will have the reverse process.</p>
        <p>This means that if <m>f</m> and <m>g</m> are inverses, then both of the following will be true: <md>
        <mrow>f(g(x)) \amp= x</mrow>
        <mrow>g(f(x)) \amp= x</mrow></md></p>
        <p>This is because whatever the inside function did with the input <m>x</m>, the outside function <em>undid</em> that action.</p>
        <example>
          <p>The functions <m>f(x) = 2^x + 1</m> and <m>g(x) = log_{2}(x - 1)</m> are inverses.</p>
          <p>In order to show this, we would use function composition to show that both of the conditions above are true.</p>
          <md><mrow>f(g(x)) \amp= f(log_{2}(x - 1))</mrow>
            <mrow>\amp= 2^{\displaystyle{log_{2}(x - 1)}} + 1</mrow>
            <mrow>\amp= (x - 1) + 1</mrow>
            <mrow>\amp= x</mrow></md>
          <p>This shows that <m>f(g(x)) = x</m>. Similarly, we have:<md>
            <mrow>g(f(x)) \amp= g(2^x+1)</mrow>
            <mrow>\amp= log_{2}\left((2^x+1)-1\right)</mrow>
            <mrow>\amp= log_{2}\left(2^x\right)</mrow>
            <mrow>\amp= x</mrow></md></p>
          <p>This shows that <m>g(f(x)) = x</m>.</p>
        </example>

        <paragraphs>
          <title>Notation</title>
          <p>If <m>h(x)</m> is a function, then its inverse is called <m>h^{-1}</m>. This notation does <em xml:id="note-about-inverse-exponent">not</em> mean that <m>h</m> is being raised to a negative exponent &#8212; rather, it is just special notation for an inverse function.</p>
          <p>We use this special notation either when we want to talk about the inverse of some function, or when we want to find the formula for the inverse.</p>
        </paragraphs>

        <paragraphs>
          <title>Interpreting the notation</title>
          <p>If <m>f</m> takes an input <m>a</m> and gives an output <m>b</m>, then its inverse <m>f^{-1}</m> would take <m>b</m> as the input and give the output <m>a</m>.</p>
          <p>Since a function and its inverse represent reverse processes, the input and output are similarly reversed.</p>
        </paragraphs>

          <exercise>
            <webwork>
              <setup>
                <var name="$m"><static>33</static></var>
                <var name="$x[0]"><static>10</static></var>
                <var name="$x[1]"><static>15</static></var>
                <var name="$y[0]"><static>780</static></var>
                <var name="$y[1]"><static>945</static></var>
                <var name="$inverseInput">
                  <set>
                    <member>\text{?}</member>
                    <member>\text{Years}</member>
                    <member>\text{People}</member>
                  </set>
                </var>
                <pg-code>
                  $m=random(25,35,1);
                  @x=map{$_+2}NchooseK(14,2);
                  @y=map{450+$_*$m}@x;
                  $inverseInput=PopUp(
                  ["?","Years","People"],"People");
                </pg-code>
              </setup>

              <statement>
                <p>Let <m>P(t)</m> be the function which calculates the population of a small town, where <m>t</m> is the number of years after 2000.</p>
                <p>Since <m>P</m> takes <em>years</em> as input and gives <em>people</em> as ouput, we should also be able to describe the meaning of the inverse, <m>P^{-1}</m>.</p>
                <p>What is a possible <em>input</em> for <m>P^{-1}</m>?</p>
                <p><var name="$inverseInput" form="popup" /></p>
                <p>Suppose <m>P(<var name="$x[0]" />) = <var name="$y[0]" /></m> and <m>P(<var name="$x[1]" />) = <var name="$y[1]" /></m></p>
                <p>What is <m>P^{-1}(<var name="$y[1]" />)</m>?</p>
                <p>Answer:  <var name="$x[1]" width="10" /></p>
              </statement>
              <hint>
                <p>A function and its inverse do opposite things: The input and ouput for one function become the output and input for the inverse function.</p>
              </hint>
              <solution>
                <ol>
                  <li><p>For <m>P^{-1}</m>, the inputs must be <var name="$inverseInput" />, because those were the outputs from the function <m>P</m></p></li>
                  <li><p>Since <m>P(<var name="$x[1]" />) = <var name="$y[1]" /></m>, then we swap the input and output and see that: <me>P^{-1}(<var name="$y[1]" />) = <var name="$x[1]" /></me></p></li>
                </ol>
              </solution>
            </webwork>
          </exercise>

          <exercise>
            <webwork xml:id="webwork-windchill">
              <setup>
                <var name="$rand[0]"><static>0</static></var>
                <var name="$rand[1]"><static>1</static></var>
                <var name="$x[0]"><static>0</static></var>
                <var name="$x[1]"><static>10</static></var>
                <var name="$x[2]"><static>20</static></var>
                <var name="$x[3]"><static>30</static></var>
                <var name="$x[4]"><static>40</static></var>
                <var name="$x[5]"><static>50</static></var>
                <var name="$x[6]"><static>60</static></var>
                <var name="$f[0]"><static>40</static></var>
                <var name="$f[1]"><static>34</static></var>
                <var name="$f[2]"><static>30</static></var>
                <var name="$f[3]"><static>28</static></var>
                <var name="$f[4]"><static>27</static></var>
                <var name="$f[5]"><static>26</static></var>
                <var name="$f[6]"><static>25</static></var>
                <var name="$statements">
                  <set>
                    <member>W(28) = 30\text{ and }W^{-1}(50) = 26</member>
                    <member correct="yes">W(30) = 28\text{ and }W^{-1}(26) = 50</member>
                  </set>
                </var>
                  <pg-code>
                    @rand=map{$_+1}NchooseK(6,4);
                    @x=(0,10,20,30,40,50,60);
                    @f=(40,34,30,28,27,26,25);
                    $statements=RadioButtons(
                    ["\(W($f[$rand[0]])=$x[$rand[0]]\) and \(W^{-1}($x[$rand[1]])=$f[$rand[1]]\)", "\(W($x[$rand[2]])=$f[$rand[2]]\) and \(W^{-1}($f[$rand[3]])=$x[$rand[3]]\)"],
                    1, labels => ["no","way"],
                    displayLabels => 0
                    );
                </pg-code>
              </setup>
              <statement>
                <p>On a cold day, when the wind blows, it <em>feels</em> colder than it actually is outside. The temperature you feel is called the <em>wind chill</em> temperature.</p>
                <p>The table below shows values of the function <m>W(S)</m>, which calculates the wind chill temperature when it is <m>40^{\circ}F</m> outside and the wind is blowing at <m>S</m> miles per hour.</p>
                <table>
                  <tabular top="major" halign="center">
                        <col halign="left" />
                        <col />
                        <row bottom="medium">
                          <cell><m>S</m></cell>
                          <cell><m>W(S)</m></cell>
                        </row>
                        <row>
                          <cell><m><var name="$x[0]" /></m></cell>
                          <cell><var name="$f[0]" /></cell>
                        </row>
                        <row>
                          <cell><m><var name="$x[1]" /></m></cell>
                          <cell><var name="$f[1]" /></cell>
                        </row>
                        <row>
                          <cell><m><var name="$x[2]" /></m></cell>
                          <cell><var name="$f[2]" /></cell>
                        </row>
                        <row>
                          <cell><m><var name="$x[3]" /></m></cell>
                          <cell><var name="$f[3]" /></cell>
                        </row>
                        <row>
                          <cell><m><var name="$x[4]" /></m></cell>
                          <cell><var name="$f[4]" /></cell>
                        </row>
                        <row>
                          <cell><m><var name="$x[5]" /></m></cell>
                          <cell><var name="$f[5]" /></cell>
                        </row>
                        <row>
                          <cell><m><var name="$x[6]" /></m></cell>
                          <cell><var name="$f[6]" /></cell>
                        </row>
                  </tabular>
                </table>
                <p>Which pair of statements is true?</p>
                <p><var name="$statements" form="buttons" /></p>
              </statement>
              <solution>
                <p>The true statements are: <me><var name="$statements" /></me></p>
              </solution>
            </webwork>
          </exercise>

      </subsection>
    </conclusion>
</chapter>
